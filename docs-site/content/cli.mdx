---
title: CLI Reference
description: Complete reference for all BTMG command-line commands, options, and usage examples.
---

## Overview

The `btmg` CLI is the primary way to manage your graph-docs sync pipeline outside of an MCP session. All commands read configuration from `btmg.config.ts` in the current working directory unless overridden with `--config`.

Install globally or use via `npx`:

```bash
npm install -g btmg-fourthspace
# or
npx btmg <command>
```

---

## `btmg init`

Scaffolds a `btmg.config.ts` configuration file in the current directory.

```bash
btmg init
```

This creates a typed configuration file with sensible defaults and inline comments explaining each option. Run this once when setting up a new project.

**Output:**

```
Created btmg.config.ts
```

**Example generated config:**

```ts
import { defineConfig } from 'btmg-fourthspace';

export default defineConfig({
  neo4j: {
    uri: process.env.NEO4J_URI ?? 'bolt://localhost:7687',
    user: process.env.NEO4J_USER ?? 'neo4j',
    password: process.env.NEO4J_PASSWORD ?? '',
  },
  docs: {
    dir: './docs',
  },
  sync: {
    conflictStrategy: 'graph-wins',
  },
});
```

---

## `btmg migrate`

Applies schema constraints to your Neo4j database based on the schema defined in `btmg.config.ts`. This creates uniqueness constraints, property existence constraints, and indexes required for BTMG to function correctly.

```bash
btmg migrate
```

Run this once after `init` and again whenever you change the schema definition.

**Options:**

| Flag | Description |
|---|---|
| `--dry-run` | Print the Cypher statements that would be executed without applying them. |
| `--config <path>` | Path to a custom config file. Defaults to `./btmg.config.ts`. |

**Example:**

```bash
btmg migrate --dry-run
```

---

## `btmg sync`

Runs a full bidirectional sync between the Neo4j graph and your docs directory.

```bash
btmg sync --docs ./docs --strategy graph-wins
```

**Options:**

| Flag | Description |
|---|---|
| `--docs <path>` | Path to the docs directory. Overrides the value in config. |
| `--strategy <strategy>` | Conflict strategy: `graph-wins`, `docs-wins`, `merge`, or `fail`. Overrides the value in config. |
| `--dry-run` | Compute and display the changeset without writing any files or graph updates. |
| `--verbose` | Print detailed output for each entity processed, including hash comparisons. |
| `--config <path>` | Path to a custom config file. |

**Examples:**

```bash
# Default sync using config file settings
btmg sync

# Sync with docs-wins strategy, verbose output
btmg sync --strategy docs-wins --verbose

# Preview changes without applying them
btmg sync --dry-run
```

**Output:**

```
Sync complete
  Graph -> Docs:  12 updated, 3 created, 0 deleted
  Docs -> Graph:   2 updated, 0 created, 0 deleted
  Conflicts:       1 resolved (graph-wins)
```

---

## `btmg snapshot`

Reconstructs the full graph state at a given point in time and outputs it as JSON. Uses the audit log to replay changes up to the specified timestamp.

```bash
btmg snapshot "2024-06-01T00:00:00Z"
```

**Arguments:**

| Argument | Description |
|---|---|
| `<timestamp>` | ISO 8601 timestamp. The snapshot reflects the graph state at this exact moment. |

**Options:**

| Flag | Description |
|---|---|
| `--label <label>` | Restrict the snapshot to entities of a specific label. |
| `--output <path>` | Write the snapshot JSON to a file instead of stdout. |
| `--config <path>` | Path to a custom config file. |

**Examples:**

```bash
# Full graph snapshot at a specific time
btmg snapshot "2024-06-01T00:00:00Z"

# Snapshot only Service entities, written to a file
btmg snapshot "2024-06-01T00:00:00Z" --label Service --output snapshot.json
```

---

## `btmg changelog`

Prints the full version history for a specific entity, ordered from newest to oldest. Each entry shows which properties changed and their before/after values.

```bash
btmg changelog <id>
```

**Arguments:**

| Argument | Description |
|---|---|
| `<id>` | The `_id` of the entity to inspect. |

**Options:**

| Flag | Description |
|---|---|
| `--limit <n>` | Return only the most recent N versions. Defaults to all. |
| `--format <format>` | Output format: `table` (default) or `json`. |
| `--config <path>` | Path to a custom config file. |

**Examples:**

```bash
# Full changelog for an entity
btmg changelog auth-service

# Last 5 versions as JSON
btmg changelog auth-service --limit 5 --format json
```

**Output:**

```
auth-service changelog (7 versions)

v7  2024-06-15T10:22:00Z  agent:coding-agent
    status: "in-progress" -> "complete"
    commitSha: (none) -> "a3f8b2c"

v6  2024-06-14T09:01:00Z  agent:planning-agent
    status: "planned" -> "in-progress"
```

---

## `btmg validate`

Validates a proposed set of properties against the schema for a given label without writing anything to the graph. Useful for testing data before ingestion.

```bash
btmg validate Service '{"name": "Test"}'
```

**Arguments:**

| Argument | Description |
|---|---|
| `<label>` | The entity label to validate against. |
| `<properties>` | A JSON string of properties to validate. |

**Options:**

| Flag | Description |
|---|---|
| `--config <path>` | Path to a custom config file. |

**Examples:**

```bash
# Valid properties
btmg validate Service '{"name": "Auth Service", "status": "active"}'
# Output: Valid

# Invalid properties
btmg validate Service '{"name": "Auth Service", "status": "unknown-status"}'
# Output: Validation failed
#   status: "unknown-status" is not a valid value. Expected one of: active, deprecated, planned
```

---

## `btmg query`

Query entities from the graph and print results to stdout.

```bash
btmg query --label Service
```

**Options:**

| Flag | Description |
|---|---|
| `--label <label>` | Filter by entity label. |
| `--filter <json>` | JSON object of property filters to apply (equality matching). |
| `--cypher <query>` | Run a raw Cypher query. Returns results as JSON. |
| `--format <format>` | Output format: `table` (default) or `json`. |
| `--limit <n>` | Maximum number of results to return. Defaults to 100. |
| `--config <path>` | Path to a custom config file. |

**Examples:**

```bash
# List all Service entities
btmg query --label Service

# Filter by property value
btmg query --label Service --filter '{"status": "active"}'

# Raw Cypher query
btmg query --cypher "MATCH (s:Service)-[:DEPENDS_ON]->(d:Database) RETURN s.name, d.name"

# Output as JSON
btmg query --label Service --format json
```

---

## `btmg serve`

Starts the MCP server and listens on stdio for MCP client connections. This is the entry point used by Claude Desktop, Cursor, and other MCP-compatible agents.

```bash
btmg serve
```

**Options:**

| Flag | Description |
|---|---|
| `--config <path>` | Path to a custom config file. |

The server reads Neo4j connection details from environment variables:

```bash
NEO4J_URI=bolt://localhost:7687
NEO4J_USER=neo4j
NEO4J_PASSWORD=your-password
```

The process blocks until the MCP client disconnects. Logs are written to stderr. See [MCP for AI Agents](/mcp-agents) for the full list of tools and resources exposed by the server.

**Example (running directly):**

```bash
NEO4J_URI=bolt://localhost:7687 NEO4J_USER=neo4j NEO4J_PASSWORD=secret btmg serve
```
